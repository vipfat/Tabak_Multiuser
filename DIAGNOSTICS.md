# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
**–í–´ –û–ü–£–ë–õ–ò–ö–û–í–ê–õ–ò –ü–ê–†–û–õ–¨ –û–¢ –°–ï–†–í–ï–†–ê –í –û–¢–ö–†–´–¢–û–ú –í–ò–î–ï!**

### üö® –°—Ä–æ—á–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å:
```bash
passwd root
```

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É (–ü–û–°–õ–ï –°–ú–ï–ù–´ –ü–ê–†–û–õ–Ø):
```bash
ssh root@103.88.241.78
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PM2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:
```bash
pm2 list
pm2 logs tabak-api --lines 50
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
systemctl status postgresql

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
psql -U tabakapp -d appdb -c "SELECT COUNT(*) FROM venues;"
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
cd /home/tabakapp/apps/tabak_multiuser
cat .env.local

# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å:
# - DATABASE_URL
# - JWT_SECRET (–Ω–µ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!)
# - GEMINI_API_KEY (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx:
```bash
tail -100 /var/log/nginx/error.log
tail -100 /var/log/nginx/access.log
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã:
```bash
netstat -tulpn | grep :3000  # API –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –Ω–∞ –ø–æ—Ä—Ç—É 3000
netstat -tulpn | grep :80    # Nginx –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –Ω–∞ 80
netstat -tulpn | grep :443   # Nginx –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å –Ω–∞ 443
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ:

### ‚úÖ 1. –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è —ç–Ω–¥–ø–æ–∏–Ω—Ç GET /api/venues
- –ë—ã–ª–æ –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –û—Å—Ç–∞–≤–ª–µ–Ω —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å COALESCE(title, name)

### ‚úÖ 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```javascript
max: 20,                    // –º–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
min: 2,                     // –º–∏–Ω–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
idleTimeoutMillis: 30000,   // –∑–∞–∫—Ä—ã–≤–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫
connectionTimeoutMillis: 10000 // —Ç–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è 10 —Å–µ–∫
```

### ‚úÖ 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- –î–æ–±–∞–≤–ª–µ–Ω ROLLBACK –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ PUT /api/flavors
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ finally

### ‚úÖ 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT_SECRET
- –í—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–ª—é—á

### ‚úÖ 5. –°–æ–∑–¥–∞–Ω .env.local.example
- –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## üöÄ –î–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
cd /workspaces/Tabak_Multiuser
tar -czf deploy-fix.tar.gz server/ .env.local.example
```

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
scp deploy-fix.tar.gz root@103.88.241.78:/tmp/
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
ssh root@103.88.241.78

# –ë—ç–∫–∞–ø —Ç–µ–∫—É—â–∏—Ö —Ñ–∞–π–ª–æ–≤
cd /home/tabakapp/apps/tabak_multiuser
tar -czf backup_$(date +%Y%m%d_%H%M%S).tar.gz server/

# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
tar -xzf /tmp/deploy-fix.tar.gz

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å .env.local (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
if [ ! -f .env.local ]; then
    cp .env.local.example .env.local
    echo "‚ö†Ô∏è –í–ê–ñ–ù–û: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env.local –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è!"
    nano .env.local
fi

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API
pm2 restart tabak-api
pm2 logs tabak-api
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –¢–µ—Å—Ç API
curl http://localhost:3000/api/test

# –¢–µ—Å—Ç venues
curl http://localhost:3000/api/venues

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs tabak-api --lines 20
```

---

## üîç –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞: "Database connection failed"
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DATABASE_URL –≤ .env.local
cat .env.local | grep DATABASE_URL

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç
systemctl status postgresql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î
psql -U postgres -c "\\du tabakapp"
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Pool exhausted" (–∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API
pm2 restart tabak-api

# –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
# (–¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤)
```

### –ü—Ä–æ–±–ª–µ–º–∞: "502 Bad Gateway" –æ—Ç Nginx
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω
pm2 list

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx
tail -50 /var/log/nginx/error.log

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx
systemctl restart nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: "JWT verification failed"
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–ª—å–Ω—ã–π JWT_SECRET –≤ .env.local
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π:
openssl rand -base64 32

# –î–æ–±–∞–≤–∏—Ç—å –≤ .env.local:
echo "JWT_SECRET=$(openssl rand -base64 32)" >> .env.local

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API
pm2 restart tabak-api
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

```bash
# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 logs tabak-api

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
pm2 monit

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç —É—Ç–µ—á–µ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
# (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)
watch -n 5 'psql -U postgres -c "SELECT count(*) FROM pg_stat_activity WHERE datname='\''appdb'\'';"'
```

---

## üìû –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å:

1. –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏:
```bash
pm2 logs tabak-api --lines 100 > /tmp/api-logs.txt
tail -100 /var/log/nginx/error.log > /tmp/nginx-logs.txt
psql -U tabakapp -d appdb -c "SELECT version();" > /tmp/db-info.txt
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
systemctl status nginx postgresql
pm2 list
```

3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤—ã–≤–æ–¥ —ç—Ç–∏—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
